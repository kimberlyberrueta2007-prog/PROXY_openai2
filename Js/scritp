const CHAT_URL = " ";
const IMAGE_URL = " ";


const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

const crearBtn = document.getElementById("crearBtn");
const asesorarBtn = document.getElementById("asesorarBtn");
const aprenderBtn = document.getElementById("aprenderBtn");

// AÃ±adir mensaje al chat
function addMessage(content, sender, isImage = false) {
  const msg = document.createElement("div");
  msg.classList.add("message", sender);

  if (isImage) {
    const img = document.createElement("img");
    img.src = content;
    img.alt = "Imagen generada por IA";
    img.classList.add("generated-image");
    msg.appendChild(img);

    // BotÃ³n de descarga
    const downloadBtn = document.createElement("button");
    downloadBtn.textContent = "â¬‡ï¸ Descargar imagen";
    downloadBtn.classList.add("download-btn");
    downloadBtn.onclick = () => {
      const link = document.createElement("a");
      link.href = content;
      link.download = "arte_generado.png";
      link.click();
    };
    msg.appendChild(downloadBtn);
  } else {
    msg.textContent = content;
  }

  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// FunciÃ³n principal del bot
async function botReply(userText) {
  addMessage("ğŸ¨ Procesando tu idea artÃ­stica...", "bot");

  // Limpieza o detecciÃ³n de sÃ­mbolos especiales
  const cleanText = userText.replace(/[*#-]+/g, "").trim();

  // Si el usuario pide una imagen o dibujo
  if (
    cleanText.toLowerCase().includes("imagen") ||
    cleanText.toLowerCase().includes("dibujo") ||
    cleanText.toLowerCase().includes("pintura") ||
    cleanText.toLowerCase().includes("arte") ||
    cleanText.toLowerCase().includes("flor") ||
    cleanText.toLowerCase().includes("paisaje")
  ) {
    try {
      const imgRes = await fetch(IMAGE_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "gpt-image-1",
          prompt: cleanText,
          size: "512x512",
          style: "artistic",
        }),
      });

      const data = await imgRes.json();
      const imageUrl = data.data?.[0]?.url;

      if (imageUrl) {
        addMessage(imageUrl, "bot", true);
      } else {
        addMessage("âŒ No pude generar la imagen, intenta con otra descripciÃ³n mÃ¡s artÃ­stica.", "bot");
      }
    } catch (err) {
      addMessage("âš ï¸ Error al generar la imagen. Revisa tu API Key o conexiÃ³n.", "bot");
    }
    return;
  }

  // Si solo pide texto (asesorÃ­a o aprendizaje)
  try {
    const response = await fetch(CHAT_URL, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          {
            role: "system",
            content: "Eres DiseÃ±aArte, un asistente experto en dibujo, pintura y creatividad. Responde como un artista profesional, ofreciendo explicaciones lÃ³gicas, inspiradoras y fÃ¡ciles de comprender.",
          },
          { role: "user", content: cleanText },
        ],
        temperature: 0.8,
      }),
    });

    const data = await response.json();
    const botMessage = data.choices?.[0]?.message?.content || "âŒ No se recibiÃ³ respuesta.";
    addMessage(botMessage, "bot");
  } catch (error) {
    console.error(error);
    addMessage("âš ï¸ Error al conectar con OpenAI.", "bot");
  }
}

// Enviar mensaje al hacer clic
sendBtn.addEventListener("click", () => {
  const text = userInput.value.trim();
  if (!text) return;
  addMessage(text, "user");
  userInput.value = "";
  botReply(text);
});

// Enviar con tecla Enter
userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") sendBtn.click();
});

// Botones de modo
crearBtn.addEventListener("click", () => {
  botReply("ğŸ¨ Modo Crear Arte activado. Describe tu idea y generarÃ© una pintura o dibujo para ti.");
});

asesorarBtn.addEventListener("click", () => {
  botReply("ğŸ§  Modo Asesorar DiseÃ±o activado. CuÃ©ntame tu idea o estilo, y te brindarÃ© una guÃ­a artÃ­stica detallada.");
});

aprenderBtn.addEventListener("click", () => {
  botReply("ğŸ“š Modo Aprender Arte activado. Â¿QuÃ© tÃ©cnica o estilo te gustarÃ­a practicar hoy?");
});
